<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Jeca Maracatu</title>

    <link rel="icon" href="img/jeca-logo.png">
</head>
<body>
    <div id="game">
        <header>
            <div class="log">
            <h2>ğŸŠ</h2>
            <h1>JecaMaracatu</h1>
            </div>
        <nav>
           <button>âš™ï¸</button>
           <button>ğŸ›’</button>
           <button>ğŸ“’</button>
           <button>ğŸ‘¤</button>
        </nav>
        </header>
    </div>

    <main>

        <!-- colisÃ£o -->
        <img id="mesa1" src="img-cenario/Mesa.png"></div>
        <img id="mesa2" src="img-cenario/Mesa.png"></div>
        <img id="mesa3" src="img-cenario/Mesa.png"></div>
        <img id="QUADRADO" draggable="true"></div>
        <div id="parede"></div>
        <div id="parede2"></div>
        <div id="chao"></div>
        <img id="espatula" src="img/espatula.png" draggable="true">


        <!-- game area -->
        <div id="game-area">
            <img src="img/Jeca-paradoR.gif" id="player" class="player" alt="Player">

            <img src="img-cenario/fundo.png" alt="fundo" class="fundo">
        </div>
              
    </main>

        <script>
            const main = document.querySelector('main');
            const gameArea = document.getElementById('game-area');
            const player = document.getElementById('player');
            const espatula = document.getElementById('espatula');


            let endpositionR
            let move = false 
            let posX = 300; // posiÃ§Ã£o inicial (meio)
            let posY = 200;

            let mesa2Y = 1000
            let mesa3Y = 350

            let loop = 0;
            let count = 0;


            
            
            // const myElement = document.getElementById('myElement'); // Or use querySelector, etc.
            // const rect = myElement.getBoundingClientRect();
            // console.log('Top:', rect.top); 
            // console.log('Left:', rect.left); 

            let targetX = posX;
            let targetY = posY;
            const speed = 6; // velocidade do movimento

            // Atualiza posiÃ§Ã£o do personagem a cada frame
            function update() {

                const dx = targetX - posX;
                const dy = targetY - posY;
                //calcula a diferenÃ§a de distÃ¢ncia a ser percorrida horizontalmente e verticamente utilizando o teorema de pitÃ¡goras
                const distance = Math.sqrt(dx * dx + dy * dy);

                // alterar velocidade junto com este
                if (distance > 3) {
                    move = true
                    console.log("movimentando")
                    console.log(distance)

                    posX += (dx / distance) * speed;
                    posY += (dy / distance) * speed;

                    player.style.left = posX + "px";
                    player.style.top = posY + "px";

                } else if (distance <= 3 && move == true) {
                    move = false
                    
                    if (endposition == "left") {
                    player.src = "img/Jeca-paradoL.gif"
                    }
                    if (endposition == "right") {
                    player.src = "img/Jeca-paradoR.gif"
                    }

                    console.log("fim do movimento")
                    
                }
                requestAnimationFrame(update);
            }

            function posMouse(e) {
                num = console.log(e.offsetX, e.offsetY);
            }


            espatula.addEventListener('dragstart', e => {
                e.dataTransfer.setData('espat', 'espatula'); // marca o item
            });

            function createTargets() {
                for (let i = 1; i <= 10; i++) {
                    const element = document.createElement("div");
                    element.id = "target" + i;
                    element.style.zIndex = 99999999999;
                    element.dataset.target = 0;
                    element.style.width = "50px";
                    element.style.height = "50px";
                    element.style.position = "absolute";
                    element.style.left = i*50  + 100 + "px";
                    element.style.top  = "80px";
                    element.style.backgroundColor = "red";


                    element.addEventListener('dragover', e => {
                    e.preventDefault();

                    const data = e.dataTransfer.getData('espat');
                        
                    if (element.dataset.target === 0) {
                        element.dataset.target = 1;
                        count = count + 1;
                        element.style.backgroundColor = "cyan";

                        if (count === 10) {
                        loop = loop + 1;
                        element.dataset.target = 0;
                        count = 0;
                        }
                    }
                    

                    });

                    main.appendChild(element);
                }
            }

            // Detecta clique e define novo destino
            gameArea.addEventListener('click', (event) => {
                move = true
                const rect = gameArea.getBoundingClientRect();
                targetX = event.clientX - rect.left ; // centraliza no meio do quadrado. Metade dos px do quadrado 
                targetY = event.clientY - rect.top - 70;
            });

            gameArea.addEventListener('click', (event) => {
                const dx = targetX - posX;
                const dy = targetY - posY;
                const distance = Math.sqrt(dx * dx + dy * dy);

                console.log("animation")

                if (targetX < posX) {
                    player.src = "img/Jeca-correndoL.gif"
                    endposition = "left"
                } else {
                    player.src = "img/Jeca-correndoR.gif"
                    endposition = "right"
                }
            });

            
            update(); // inicia loop de animaÃ§Ã£o
            createTargets();
    
        </script>
</body>
</html>